---
title: ã€Šè‹ç©¹å¤–å–ã€‹è§£å†³å¾®ä¿¡ç™»å½•æ¨¡å—
tags: [è‹ç©¹å¤–å–]
categories: [é¡¹ç›®è®°å½•]
date: 2026.1.25
description:
---

## 1. èƒŒæ™¯
å¾®ä¿¡å°ç¨‹åºç‚¹å‡»ç™»å½•åï¼Œloginå¤±è´¥ï¼Œæ— æ³•æ­£å¸¸ç™»å½•ï¼Œæ— æ³•åŠ è½½èœå“é¡µé¢ã€‚

## 2. æ­£æ–‡å†…å®¹

é—®é¢˜çš„æ ¹æºæ˜¯ï¼š@AutoFill æ³¨è§£æ˜¯ä¸ºç®¡ç†ç«¯çš„å®ä½“ç±»è®¾è®¡çš„ï¼ˆå¦‚ Employeeã€Category ç­‰ï¼‰ï¼Œè¿™äº›å®ä½“ç±»æœ‰ createUser å’Œ updateUser å­—æ®µã€‚ä½† User æ˜¯ Cç«¯ç”¨æˆ·å®ä½“ï¼Œå®ƒæ²¡æœ‰è¿™ä¸¤ä¸ªå­—æ®µã€‚

 é—®é¢˜æ ¹æºè¯¦è§£
 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  User å®ä½“ç±»åªæœ‰ï¼š                                                       â”‚
â”‚  - id, openid, name, phone, sex, idNumber, avatar, createTime          â”‚
â”‚                                                                         â”‚
â”‚  AutoFillAspect å°è¯•è°ƒç”¨ï¼š                                               â”‚
â”‚  - setCreateUser() â† âŒ User æ²¡æœ‰è¿™ä¸ªæ–¹æ³•ï¼                              â”‚
â”‚  - setUpdateUser() â† âŒ User æ²¡æœ‰è¿™ä¸ªæ–¹æ³•ï¼                              â”‚
â”‚  - setCreateTime() â† âœ… æœ‰                                              â”‚
â”‚  - setUpdateTime() â† âŒ User æ²¡æœ‰è¿™ä¸ªæ–¹æ³•ï¼                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


### 2.1 æ ¸å¿ƒçŸ¥è¯†
- @AutoFill æ˜¯ä¹‹å‰å†™çš„å…¬å…±å­—æ®µè‡ªåŠ¨å¡«å……åŠŸèƒ½ï¼Œå®ƒä¼šå°è¯•è°ƒç”¨å®ä½“ç±»çš„ setCreateUser()å’ŒsetUpdateUser()æ–¹æ³•ã€‚

- @AutoFill æ³¨è§£æ˜¯ä¸ºç®¡ç†ç«¯å®ä½“è®¾è®¡çš„ï¼ˆå¦‚ Employeeã€Dishã€Categoryï¼‰ï¼Œå®ƒä»¬æœ‰ createUserã€updateUserã€createTimeã€updateTime å››ä¸ªå…¬å…±å­—æ®µã€‚ä½† User æ˜¯ Cç«¯ç”¨æˆ·ï¼Œå¾®ä¿¡ç”¨æˆ·è‡ªå·±æ³¨å†Œçš„ï¼Œä¸éœ€è¦è®°å½•"è°åˆ›å»ºäº†è¿™ä¸ªç”¨æˆ·"ã€‚

- âœ… è§£å†³æ–¹æ¡ˆï¼šç§»é™¤ @AutoFill æ³¨è§£
ä» UserMapper.insert() æ–¹æ³•ä¸Šç§»é™¤ @AutoFill æ³¨è§£å³å¯


### 2.2 ä»£ç 
åœ¨sky-take-out\sky-server\src\main\java\com\sky\annotation\AutoFill.java

```java
@AutoFill(OperationType.INSERT)  // â† è¿™ä¸ªæ³¨è§£è§¦å‘äº† AutoFillAspect
void insert(User user);
```

### 2.3 ä¸»è¦è¿‡ç¨‹

- é—®é¢˜åˆ†æä¸æ’æŸ¥æ€è·¯ï¼š
    - è¯·æ±‚å·²ç»åˆ°è¾¾äº† UserController.login() æ–¹æ³•ï¼ˆæ–­ç‚¹èƒ½è§¦å‘ï¼‰ï¼Œä½†æ²¡æœ‰å¾—åˆ° responseã€‚è¿™è¯´æ˜é—®é¢˜å¾ˆå¯èƒ½å‡ºåœ¨ä»¥ä¸‹å‡ ä¸ªç¯èŠ‚ï¼š

    1. å¾®ä¿¡ API è°ƒç”¨å¤±è´¥ï¼Œopenid è¿”å› nullï¼›å³ getOpenid() æ–¹æ³•è°ƒç”¨å¾®ä¿¡æ¥å£å¯èƒ½å¤±è´¥ï¼Œä½†ä»£ç æ²¡æœ‰æ‰“å°è¿”å›ç»“æœã€‚
    2. æŠ›å‡ºå¼‚å¸¸ä½†è¢«åæ‰ï¼›LoginFailedException è¢«æŠ›å‡ºåï¼Œå…¨å±€å¼‚å¸¸å¤„ç†å™¨è¿”å›äº†é”™è¯¯ï¼Œä½†å°ç¨‹åºæ²¡æ­£ç¡®å¤„ç†ã€‚
    3. code è¿‡æœŸæˆ–é‡å¤ä½¿ç”¨ï¼Œå¾®ä¿¡çš„ js_code æ˜¯ä¸€æ¬¡æ€§çš„ï¼Œ5åˆ†é’Ÿå†…æœ‰æ•ˆï¼Œé‡å¤ä½¿ç”¨ä¼šå¤±è´¥ã€‚

- âœ…è§£å†³æ–¹æ³•ï¼š
    - ğŸ”´ Step 1ï¼šåœ¨ UserServiceImpl æ‰“æ–­ç‚¹ï¼Œè§‚å¯Ÿå¾®ä¿¡æ¥å£è¿”å›å€¼ï¼›
    - ğŸ”´ Step 2ï¼šç»™ä»£ç åŠ æ›´è¯¦ç»†çš„æ—¥å¿— 
    - ğŸ”´ Step 3ï¼šæ£€æŸ¥ IDEA æ§åˆ¶å°çš„æ—¥å¿—è¾“å‡º
    - ä»£ç ï¼š
```java
    private String getOpenid(String code) {
    Map<String, String> map = new HashMap<>();
    map.put("appid", weChatProperties.getAppid());
    map.put("secret", weChatProperties.getSecret());
    map.put("js_code", code);
    map.put("grant_type", "authorization_code");
    
    String json = HttpClientUtil.doGet(WX_LOGIN, map);  // ğŸ‘ˆ åœ¨è¿™é‡Œæ‰“æ–­ç‚¹ï¼
    
    // ğŸ‘‡ å»ºè®®æ·»åŠ æ—¥å¿—ï¼Œçœ‹çœ‹å¾®ä¿¡è¿”å›äº†ä»€ä¹ˆ
    log.info("å¾®ä¿¡æ¥å£è¿”å›ï¼š{}", json);
    
    JSONObject jsonObject = JSON.parseObject(json);
    String openid = jsonObject.getString("openid");
    return openid;
}
```
    

## 3. æ€»ç»“
æˆ‘å­¦åˆ°äº†ä»€ä¹ˆï¼Ÿ

IDEAä¸­debugå¸¸ç”¨å¿«æ·é”®ï¼š
- F8 Step Over:è·³è¿‡ï¼Œä¸€è¡Œä¸€è¡Œçš„å‘ä¸‹èµ°ï¼Œå¦‚æœå½“å‰è¡Œæœ‰æ–¹æ³•ä¸è¿›å…¥æ–¹æ³•ã€‚
- F7 Step Intoï¼šè·³å…¥ï¼Œå¦‚æœå½“å‰æœ‰æ–¹æ³•ï¼Œè¿›å…¥æ–¹æ³•å†…éƒ¨ï¼Œä¸€èˆ¬ç”¨äºè¿›å…¥è‡ªå®šä¹‰çš„æ–¹æ³•ï¼Œä¸ä¼šjdkç±»åº“çš„æ–¹æ³•ã€‚
- Shift+ F8 Step Out:è·³å‡ºï¼Œä»è·³å…¥çš„æ–¹æ³•å†…é€€å‡ºåˆ°æ–¹æ³•è°ƒç”¨å¤„ï¼Œè¿™ä¸ªæ—¶å€™æ–¹æ³•å·²ç»æ‰§è¡Œå®Œæ¯•ï¼Œåªæ˜¯è¿˜æ²¡æœ‰å®Œæˆèµ‹å€¼
- Alt+Shift+F7 Force Step Into :å¼ºåˆ¶è·³å…¥ï¼Œå¯ä»¥è¿›å…¥ä»»ä½•æ–¹æ³•ï¼Œæƒ³æŸ¥çœ‹åº•å±‚æºä»£ç å¯ä»¥ç”¨è¿™ä¸ªè¿›å…¥jdkçš„æ–¹æ³•ã€‚
- F9 Resume Program:æ¢å¤ç¨‹åºï¼Œæ¯”å¦‚ï¼Œä½ åœ¨ç¬¬3è¡Œå’Œ5è¡Œå„è‡ªéƒ½æ‰“äº†æ–­ç‚¹ï¼Œå½“å‰è¿è¡Œåˆ°ç¬¬3è¡Œï¼ŒæŒ‰F9,åˆ™è¿è¡Œåˆ°ä¸‹ä¸€ä¸ªæ–­ç‚¹å³ç¬¬5è¡Œï¼Œå†æŒ‰F9ï¼Œåˆ™è¿è¡Œå®Œæ•´ä¸ªæµç¨‹ï¼Œå› ä¸ºåé¢å·²ç»æ²¡æœ‰æ–­ç‚¹äº†
- Ctrl+First+ F8 View Breakpoints:æŸ¥çœ‹ä½ è®¾ç½®çš„æ‰€æœ‰æ–­ç‚¹ã€‚

## 4.èµ„æ–™
- [å°ç¨‹åºç™»å½•æµç¨‹](https://developers.weixin.qq.com/miniprogram/dev/framework/open-ability/login.html)
