---
title: Day07-01åˆ°12ã€Šç¼“å­˜åŠŸèƒ½ã€‹
tags: [ä¸€åˆ·è‹ç©¹å¤–å–]
date: 2026-01-29
---

# ğŸ¥ Day07-01åˆ°05 ç¼“å­˜èœå“

## ğŸ§© æœ¬èŠ‚æ¦‚è¿°

> **ä¸€å¥è¯æ€»ç»“**ï¼šé€šè¿‡ Redis ç¼“å­˜èœå“æ•°æ®ï¼Œå‡å°‘æ•°æ®åº“æŸ¥è¯¢æ“ä½œï¼Œæå‡ç³»ç»Ÿæ€§èƒ½

**ä¸»è¦å†…å®¹å…³é”®è¯**ï¼š`Redisç¼“å­˜`ã€`SpringCache`

---

## ğŸ§  æ¨¡å—ç›®æ ‡

- å°ç¨‹åºå±•ç¤ºèœå“æ•°æ®æ˜¯é€šè¿‡æ•°æ®åº“è·å¾—ï¼Œè‹¥ç”¨æˆ·ç«¯è®¿é—®é‡å¤§ï¼Œæ•°æ®åº“è®¿é—®å‹åŠ›éšä¹‹å¢å¤§
- é€šè¿‡ Redis ç¼“å­˜èœå“æ•°æ®ï¼Œå‡å°‘æ•°æ®åº“æŸ¥è¯¢æ“ä½œ

---

## ğŸ”„ å®ç°æµç¨‹

1. ç”¨æˆ·å°ç¨‹åºæŸ¥è¯¢èœå“æ•°æ®
2. åˆ°è¾¾åç«¯æœåŠ¡ï¼Œå…ˆåˆ¤æ–­ç¼“å­˜æ˜¯å¦æœ‰èœå“æ•°æ®
3. æœ‰ç¼“å­˜æ•°æ® â†’ è¯»å–ç¼“å­˜æ•°æ®
4. æ²¡æœ‰ç¼“å­˜æ•°æ® â†’ æŸ¥è¯¢æ•°æ®åº“å¹¶å“åº” â†’ å°†æ•°æ®è½½å…¥ç¼“å­˜

---

## ğŸ”„ ç¼“å­˜é€»è¾‘

1. æ¯ä¸ªåˆ†ç±»ä¸‹çš„èœå“ä¿å­˜ä¸€ä»½ç¼“å­˜æ•°æ®ï¼Œå°†åˆ†ç±»ä½œä¸º keyï¼Œèœå“è½¬ä¸º String ä½œä¸º value
2. æ•°æ®åº“ä¸­èœå“æœ‰å˜æ›´æ—¶è¦æ¸…ç†ç¼“å­˜æ•°æ®

---

## ğŸ“˜ å­¦åˆ°çš„çŸ¥è¯†

### ğŸ“š Part 1: æ³¨è§£åŸºç¡€æ¶è¡¥

ä»£ç é‡Œçš„æ³¨è§£åˆ†æˆä¸‰ç±»ï¼š

#### ğŸŸ¢ Spring æ¡†æ¶æ³¨è§£ï¼ˆå¿…é¡»æŒæ¡ï¼‰

| æ³¨è§£ | æ¥æº | ä½œç”¨ | é€šä¿—ç†è§£ |
|------|------|------|----------|
| `@RestController` | Spring MVC | æ ‡è®°è¿™æ˜¯ä¸€ä¸ªæ§åˆ¶å™¨ï¼Œä¸”è¿”å›å€¼è‡ªåŠ¨è½¬JSON | å‘Šè¯‰Springï¼š"æˆ‘æ˜¯ä¸ªæ¥å¾…å‘˜ï¼Œå®¢äºº(è¯·æ±‚)æ¥äº†æˆ‘å¤„ç†ï¼Œç»“æœç”¨JSONæ ¼å¼å›å¤" |
| `@RequestMapping` | Spring MVC | å®šä¹‰URLè·¯å¾„å‰ç¼€ | ç›¸å½“äº"éƒ¨é—¨é—¨ç‰Œå·"ï¼Œæ‰€æœ‰æœ¬ç±»çš„æ¥å£éƒ½ä»¥è¿™ä¸ªè·¯å¾„å¼€å¤´ |
| `@GetMapping` | Spring MVC | å¤„ç†GETè¯·æ±‚ï¼Œå®šä¹‰å…·ä½“è·¯å¾„ | ç›¸å½“äº"å·¥ä½å·"ï¼Œ`@RequestMapping("/user/dish")` + `@GetMapping("/list")` = å®Œæ•´è·¯å¾„ `/user/dish/list` |
| `@Autowired` | Spring Core | è‡ªåŠ¨æ³¨å…¥ä¾èµ–å¯¹è±¡ | å‘Šè¯‰Springï¼š"è¿™ä¸ªå·¥å…·(å¯¹è±¡)æˆ‘è¦ç”¨ï¼Œä½ å¸®æˆ‘å‡†å¤‡å¥½" |

> **ğŸ’¡ å…³äº @RestController("userDishController") çš„å‚æ•°ï¼š**
> - å‚æ•°æ˜¯ç»™è¿™ä¸ª Bean èµ·ä¸ªåå­—ï¼Œç”¨äºåŒºåˆ†åŒåç±»
> - ä¸ºä»€ä¹ˆè¦èµ·åï¼Ÿå› ä¸º admin ç«¯ä¹Ÿæœ‰ä¸€ä¸ª DishControllerï¼
> - ä¸å†™å‚æ•°ä¹Ÿè¡Œï¼ŒSpring ä¼šè‡ªåŠ¨ç”¨ç±»åï¼ˆé¦–å­—æ¯å°å†™ï¼‰ä½œä¸ºåå­—

#### ğŸŸ¡ Lombok æ³¨è§£ï¼ˆç®€åŒ–ä»£ç ï¼‰

| æ³¨è§£ | ä½œç”¨ | é€šä¿—ç†è§£ |
|------|------|----------|
| `@Slf4j` | è‡ªåŠ¨ç”Ÿæˆä¸€ä¸ª `log` å¯¹è±¡ | çœå¾—ä½ å†™ `Logger log = LoggerFactory.getLogger(...)` |

#### ğŸ”µ Swagger æ³¨è§£ï¼ˆç”Ÿæˆ API æ–‡æ¡£ï¼‰

| æ³¨è§£ | ä½œç”¨ | é€šä¿—ç†è§£ |
|------|------|----------|
| `@Api(tags = "...")` | ç»™Controlleråˆ†ç»„èµ·å | åœ¨Swaggeré¡µé¢ä¸Šæ˜¾ç¤ºçš„"å¤§æ ‡é¢˜" |
| `@ApiOperation("...")` | æè¿°å•ä¸ªæ¥å£çš„åŠŸèƒ½ | åœ¨Swaggeré¡µé¢ä¸Šæ˜¾ç¤ºçš„"å°æ ‡é¢˜" |

---

### ğŸ§  Part 2: ä»£ç ç¼–å†™çš„æ€è€ƒè¿‡ç¨‹

ä½ é—®å¾—å¥½ï¼š**æ˜¯ä¸æ˜¯è¦åœ¨ DishVO, DishService, DishServiceImpl, DishController ä¸­æ¥å›è¾—è½¬ï¼Ÿ**

ç­”æ¡ˆæ˜¯ï¼š**åœ¨è¿™ä¸ªç®€å•åœºæ™¯ä¸‹ï¼Œä½ åªéœ€è¦å…³æ³¨ Controller å±‚**ï¼

è®©æˆ‘ç”»ä¸ªå›¾å¸®ä½ ç†è§£åˆ†å·¥ï¼š

```mermaid
flowchart LR
    subgraph ä½ ç°åœ¨è¦å†™çš„
        A[DishController<br/>ç”¨æˆ·ç«¯æ§åˆ¶å™¨]
    end
    
    subgraph å·²ç»å†™å¥½çš„-ç›´æ¥è°ƒç”¨
        B[DishService<br/>ä¸šåŠ¡æ¥å£]
        C[DishServiceImpl<br/>ä¸šåŠ¡å®ç°]
        D[DishVO<br/>æ•°æ®å¯¹è±¡]
    end
    
    subgraph å·¥å…·ç±»-ç›´æ¥ç”¨
        E[RedisTemplate<br/>æ“ä½œRedis]
    end
    
    A -->|è°ƒç”¨| B
    B -->|å®ç°| C
    A -->|ä½¿ç”¨| D
    A -->|ä½¿ç”¨| E
```

**å…³é”®è®¤çŸ¥**ï¼š

- `DishVO` æ˜¯ä¸ª**æ•°æ®å®¹å™¨**ï¼Œå·²ç»å®šä¹‰å¥½äº†ï¼Œä½ ç›´æ¥ç”¨
- `DishService.listWithFlavor()` æ–¹æ³•**å·²ç»å†™å¥½äº†**ï¼Œä½ ç›´æ¥è°ƒç”¨
- ä½ åªéœ€è¦åœ¨ Controller é‡Œ**ç»„è£…é€»è¾‘**

---

### âœï¸ Part 3: æ‰‹æŠŠæ‰‹å¸¦ä½ å†™ä»£ç 

æˆ‘æŠŠä»£ç æ‹†æˆ**6ä¸ªå°æ­¥éª¤**ï¼Œæ¯æ­¥æˆ‘å…ˆé—®ä½ é—®é¢˜ï¼Œä½ æ€è€ƒåæˆ‘å†ç»™ç­”æ¡ˆï¼š

#### Step 1: æ„é€  Redis çš„ Key

```java
String key = "dish_" + categoryId;
```

âœ… ä½ è¿™æ­¥å·²ç»å†™å¯¹äº†ï¼å°±æ˜¯å­—ç¬¦ä¸²æ‹¼æ¥ã€‚

---

#### Step 2: ä» Redis æŸ¥è¯¢æ•°æ®

**é—®ä½ **ï¼š`redisTemplate` æœ‰ä¸ªæ–¹æ³•å¯ä»¥æ ¹æ® key è·å– valueï¼Œä½ çŒœæ˜¯ä»€ä¹ˆï¼Ÿ

<details>
<summary>ğŸ‘‰ ç‚¹å‡»çœ‹ç­”æ¡ˆ</summary>

```java
List<DishVO> list = (List<DishVO>) redisTemplate.opsForValue().get(key);
```

**è§£é‡Š**ï¼š

- `opsForValue()` â†’ æ“ä½œ String ç±»å‹çš„æ•°æ®
- `.get(key)` â†’ æ ¹æ® key è·å– value
- `(List<DishVO>)` â†’ å¼ºåˆ¶ç±»å‹è½¬æ¢ï¼ˆå› ä¸º Redis å–å‡ºæ¥æ˜¯ Objectï¼‰

</details>

---

#### Step 3: åˆ¤æ–­ç¼“å­˜æ˜¯å¦å‘½ä¸­

**é—®ä½ **ï¼šæ€ä¹ˆåˆ¤æ–­ `list` é‡Œæœ‰æ•°æ®ï¼Ÿï¼ˆæç¤ºï¼šä¸¤ä¸ªæ¡ä»¶ï¼‰

<details>
<summary>ğŸ‘‰ ç‚¹å‡»çœ‹ç­”æ¡ˆ</summary>

```java
if (list != null && list.size() > 0) {
    // å‘½ä¸­ç¼“å­˜
}
```

**ä¸ºä»€ä¹ˆè¦ä¸¤ä¸ªæ¡ä»¶ï¼Ÿ**

- `list != null` â†’ Redis é‡Œæœ‰è¿™ä¸ª key
- `list.size() > 0` â†’ è¿™ä¸ª key å¯¹åº”çš„åˆ—è¡¨ä¸æ˜¯ç©ºçš„

</details>

---

#### Step 4: å‘½ä¸­ç¼“å­˜ â†’ ç›´æ¥è¿”å›

**é—®ä½ **ï¼šæ€ä¹ˆæŠŠæ•°æ®åŒ…è£…æˆç»Ÿä¸€çš„è¿”å›æ ¼å¼ï¼Ÿï¼ˆæç¤ºï¼šçœ‹æ–¹æ³•è¿”å›å€¼ç±»å‹ï¼‰

<details>
<summary>ğŸ‘‰ ç‚¹å‡»çœ‹ç­”æ¡ˆ</summary>

```java
return Result.success(list);
```

**è§£é‡Š**ï¼šé¡¹ç›®é‡Œæœ‰ä¸ªç»Ÿä¸€è¿”å›ç±» `Result`ï¼Œç”¨ `Result.success()` åŒ…è£…æˆåŠŸå“åº”

</details>

---

#### Step 5: æœªå‘½ä¸­ â†’ æŸ¥è¯¢æ•°æ®åº“

**é—®ä½ **ï¼šéœ€è¦æŸ¥è¯¢"æŸåˆ†ç±»ä¸‹ã€èµ·å”®ä¸­"çš„èœå“ï¼Œæ€ä¹ˆå‘Šè¯‰ Service è¿™ä¸¤ä¸ªæ¡ä»¶ï¼Ÿ

<details>
<summary>ğŸ‘‰ ç‚¹å‡»çœ‹ç­”æ¡ˆ</summary>

```java
Dish dish = new Dish();
dish.setCategoryId(categoryId);        // æ¡ä»¶1ï¼šåˆ†ç±»ID
dish.setStatus(StatusConstant.ENABLE); // æ¡ä»¶2ï¼šèµ·å”®çŠ¶æ€

list = dishService.listWithFlavor(dish);  // è°ƒç”¨å·²æœ‰çš„Serviceæ–¹æ³•
```

**è§£é‡Š**ï¼š

- åˆ›å»ºä¸€ä¸ª `Dish` å¯¹è±¡ä½œä¸º**æŸ¥è¯¢æ¡ä»¶è½½ä½“**
- è®¾ç½®å¥½æ¡ä»¶åï¼Œè°ƒç”¨ Service å±‚çš„æ–¹æ³•
- `StatusConstant.ENABLE` æ˜¯ä¸ªå¸¸é‡ï¼Œå€¼ä¸º 1ï¼Œè¡¨ç¤º"èµ·å”®ä¸­"

</details>

---

#### Step 6: å­˜å…¥Redis + è¿”å›

**é—®ä½ **ï¼šæ€ä¹ˆæŠŠæ•°æ®å­˜è¿›Redisï¼Ÿï¼ˆæç¤ºï¼šå’Œgetç›¸åçš„æ–¹æ³•ï¼‰

<details>
<summary>ğŸ‘‰ ç‚¹å‡»çœ‹ç­”æ¡ˆ</summary>

```java
redisTemplate.opsForValue().set(key, list);  // å­˜å…¥Redis
return Result.success(list);                  // è¿”å›æ•°æ®
```

</details>

---

## ğŸ¯ å®Œæ•´ä»£ç ï¼ˆä½ å¯¹ç…§æ£€æŸ¥ï¼‰

```java
@GetMapping("/list")
@ApiOperation("æ ¹æ®åˆ†ç±»idæŸ¥è¯¢èœå“")
public Result<List<DishVO>> list(Long categoryId) {
    // 1. æ„é€ Redisçš„Key
    String key = "dish_" + categoryId;

    // 2. æŸ¥è¯¢Redis
    List<DishVO> list = (List<DishVO>) redisTemplate.opsForValue().get(key);
    
    // 3-4. å‘½ä¸­ç¼“å­˜ï¼Œç›´æ¥è¿”å›
    if (list != null && list.size() > 0) {
        return Result.success(list);
    }

    // 5. æœªå‘½ä¸­ï¼ŒæŸ¥è¯¢æ•°æ®åº“
    Dish dish = new Dish();
    dish.setCategoryId(categoryId);
    dish.setStatus(StatusConstant.ENABLE);
    list = dishService.listWithFlavor(dish);

    // 6. å­˜å…¥Rediså¹¶è¿”å›
    redisTemplate.opsForValue().set(key, list);
    return Result.success(list);
}
```

---

## ğŸ¤ é¢è¯•ä¼šæ€ä¹ˆé—®è¿™äº›åŸºç¡€ï¼Ÿ

**Q1: `@RestController` å’Œ `@Controller` æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ**

ğŸ‘‰ `@RestController` = `@Controller` + `@ResponseBody`ï¼Œè¿”å›å€¼è‡ªåŠ¨è½¬ JSON

**Q2: `@Autowired` çš„åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ**

ğŸ‘‰ ä¾èµ–æ³¨å…¥(DI)ï¼ŒSpring å®¹å™¨å¯åŠ¨æ—¶è‡ªåŠ¨æŠŠå¯¹è±¡æ³¨å…¥è¿›æ¥ï¼ˆé¢è¯•æ·±é—®ä¼šæ¶‰åŠ**åå°„**ï¼‰

---

## ğŸ—‚ï¸ å…³è”æ–‡ä»¶

```text
com/sky/controller/admin/DishController.java
com/sky/controller/user/DishController.java
```

---

# ğŸ¥ Day07-06åˆ°12 ç¼“å­˜å¥—é¤

## ğŸ§© æœ¬èŠ‚æ¦‚è¿°

> **ä¸€å¥è¯æ€»ç»“**ï¼šé€šè¿‡ Spring Cache æ³¨è§£å®ç°å¥—é¤ç¼“å­˜ï¼Œç®€åŒ–ç¼“å­˜ä»£ç ç¼–å†™

**ä¸»è¦å†…å®¹å…³é”®è¯**ï¼š`Redisç¼“å­˜`ã€`Spring Cache`

---

## ğŸ“˜ å­¦åˆ°çš„çŸ¥è¯†

### ğŸ¤” ä¸ºä»€ä¹ˆéœ€è¦ Spring Cacheï¼Ÿ

å¯¹æ¯”ä¸€ä¸‹ä½ åˆšå­¦çš„**èœå“ç¼“å­˜**ï¼ˆæ‰‹åŠ¨æ–¹å¼ï¼‰ï¼š

```java
// æ‰‹åŠ¨æ“ä½œRedis - èœå“æ¨¡å—çš„åšæ³•
String key = "dish_" + categoryId;
List<DishVO> list = (List<DishVO>) redisTemplate.opsForValue().get(key);
if (list != null && list.size() > 0) {
    return Result.success(list);
}
list = dishService.listWithFlavor(dish);
redisTemplate.opsForValue().set(key, list);  // è¿˜è¦æ‰‹åŠ¨å­˜
return Result.success(list);
```

**é—®é¢˜**ï¼šæ¯ä¸ªéœ€è¦ç¼“å­˜çš„æ–¹æ³•éƒ½è¦å†™ä¸€å †é‡å¤ä»£ç ï¼

**Spring Cache çš„è§£å†³æ–¹æ¡ˆ**ï¼šç”¨æ³¨è§£ï¼Œä¸€è¡Œæå®šï¼

---

### ğŸ—ï¸ Spring Cache æ¶æ„å›¾

```mermaid
flowchart TB
    subgraph ä½ çš„ä»£ç 
        A["@Cacheable<br/>æŸ¥è¯¢æ—¶ç”¨"]
        B["@CacheEvict<br/>åˆ é™¤/ä¿®æ”¹æ—¶ç”¨"]
        C["@CachePut<br/>æ›´æ–°ç¼“å­˜"]
    end
    
    subgraph Spring CacheæŠ½è±¡å±‚
        D[CacheManager<br/>ç¼“å­˜ç®¡ç†å™¨]
    end
    
    subgraph åº•å±‚å®ç°-å¯åˆ‡æ¢
        E1[Redis]
        E2[Caffeine<br/>æœ¬åœ°ç¼“å­˜]
        E3[EhCache]
        E4[Simple<br/>ConcurrentHashMap]
    end
    
    A & B & C --> D
    D --> E1 & E2 & E3 & E4
    
    style E1 fill:#FF6B6B
```

**æ ¸å¿ƒæ€æƒ³**ï¼šSpring Cache æ˜¯ä¸€ä¸ª**æŠ½è±¡å±‚**ï¼Œåº•å±‚å¯ä»¥æ¥ Redisã€æœ¬åœ°ç¼“å­˜ç­‰å¤šç§å®ç°ï¼Œä½ çš„ä»£ç **ä¸ç”¨æ”¹**ï¼

---

### ğŸ”‘ ä¸‰å¤§æ ¸å¿ƒæ³¨è§£

#### 1ï¸âƒ£ `@EnableCaching` - å¼€å¯ç¼“å­˜åŠŸèƒ½

```java
// åœ¨å¯åŠ¨ç±»ä¸Šæ·»åŠ ï¼Œé¡¹ç›®ä¸­å·²æœ‰ âœ…
@SpringBootApplication
@EnableCaching  // ğŸ‘ˆ æ²¡æœ‰è¿™ä¸ªï¼Œå…¶ä»–æ³¨è§£éƒ½ä¸ç”Ÿæ•ˆï¼
public class SkyApplication { ... }
```

---

#### 2ï¸âƒ£ `@Cacheable` - æŸ¥è¯¢ç¼“å­˜ï¼ˆæœ€å¸¸ç”¨ï¼‰

```java
@GetMapping("/list")
@Cacheable(cacheNames = "setmealCache", key = "#categoryId")
public Result<List<Setmeal>> list(Long categoryId) {
    // ä¸šåŠ¡ä»£ç ...ç›´æ¥å†™ï¼Œä¸ç”¨ç®¡ç¼“å­˜ï¼
    List<Setmeal> list = setmealService.list(setmeal);
    return Result.success(list);
}
```

**æ‰§è¡Œæµç¨‹**ï¼š

```mermaid
flowchart TD
    A[æ–¹æ³•è¢«è°ƒç”¨] --> B{ç¼“å­˜ä¸­æœ‰æ•°æ®?}
    B -->|âœ… æœ‰| C[ç›´æ¥è¿”å›ç¼“å­˜<br/>æ–¹æ³•ä½“ä¸æ‰§è¡Œ!]
    B -->|âŒ æ²¡æœ‰| D[æ‰§è¡Œæ–¹æ³•ä½“]
    D --> E[å°†è¿”å›å€¼å­˜å…¥ç¼“å­˜]
    E --> F[è¿”å›ç»“æœ]
    
    style C fill:#90EE90
    style D fill:#FFB6C1
```

**å‚æ•°è¯¦è§£**ï¼š

| å‚æ•° | ä½œç”¨ | ç¤ºä¾‹ |
|------|------|------|
| `cacheNames` | ç¼“å­˜åç§°ï¼ˆç›¸å½“äºåˆ†ç»„ï¼‰ | `"setmealCache"` |
| `key` | ç¼“å­˜çš„é”®ï¼Œç”¨SpELè¡¨è¾¾å¼ | `"#categoryId"` â†’ å–æ–¹æ³•å‚æ•°çš„å€¼ |

**æœ€ç»ˆRedisä¸­çš„Key**ï¼š`setmealCache::12`ï¼ˆcacheNames + "::" + keyçš„å€¼ï¼‰

---

#### 3ï¸âƒ£ `@CacheEvict` - æ¸…é™¤ç¼“å­˜

```java
// æ–°å¢å¥—é¤æ—¶ï¼Œæ¸…é™¤è¯¥åˆ†ç±»çš„ç¼“å­˜
@PostMapping
@CacheEvict(cacheNames = "setmealCache", key = "#setmealDTO.categoryId")
public Result save(@RequestBody SetmealDTO setmealDTO) { ... }

// åˆ é™¤å¥—é¤æ—¶ï¼Œæ¸…é™¤æ‰€æœ‰ç¼“å­˜
@DeleteMapping
@CacheEvict(cacheNames = "setmealCache", allEntries = true)
public Result delete(@RequestParam List<Long> ids) { ... }
```

**å‚æ•°è¯¦è§£**ï¼š

| å‚æ•° | ä½œç”¨ | ç¤ºä¾‹ |
|------|------|------|
| `key` | æ¸…é™¤æŒ‡å®škeyçš„ç¼“å­˜ | `"#setmealDTO.categoryId"` |
| `allEntries = true` | æ¸…é™¤è¯¥ç¼“å­˜åä¸‹çš„**æ‰€æœ‰**ç¼“å­˜ | åˆ é™¤/ä¿®æ”¹æ—¶å¸¸ç”¨ |

---

### ğŸ†š å¯¹æ¯”ï¼šæ‰‹åŠ¨æ“ä½œ vs Spring Cache

| å¯¹æ¯”é¡¹ | æ‰‹åŠ¨æ“ä½œ RedisTemplate | Spring Cache |
|-------|----------------------|--------------|
| **ä»£ç é‡** | å¤šï¼ˆæ¯æ¬¡7-10è¡Œï¼‰ | å°‘ï¼ˆ1è¡Œæ³¨è§£ï¼‰ |
| **ä¾µå…¥æ€§** | é«˜ï¼ˆä¸šåŠ¡ä»£ç å’Œç¼“å­˜ä»£ç æ··åœ¨ä¸€èµ·ï¼‰ | ä½ï¼ˆæ³¨è§£å£°æ˜å¼ï¼‰ |
| **çµæ´»æ€§** | é«˜ï¼ˆå¯ç²¾ç»†æ§åˆ¶ï¼‰ | ä¸­ï¼ˆæ ‡å‡†åœºæ™¯å¤Ÿç”¨ï¼‰ |
| **å­¦ä¹ æˆæœ¬** | é«˜ | ä½ |
| **é¡¹ç›®ä¸­åº”ç”¨** | èœå“æ¨¡å— (Dish) | å¥—é¤æ¨¡å— (Setmeal) |

---

### ğŸ“Š é¡¹ç›®ä¸­çš„åº”ç”¨å¯¹æ¯”å›¾

```mermaid
flowchart LR
    subgraph èœå“æ¨¡å—-æ‰‹åŠ¨æ–¹å¼
        A1[ç”¨æˆ·æŸ¥èœå“] --> A2[æ‰‹åŠ¨æŸ¥Redis]
        A2 --> A3{å‘½ä¸­?}
        A3 -->|æ˜¯| A4[è¿”å›]
        A3 -->|å¦| A5[æŸ¥DB â†’ æ‰‹åŠ¨å­˜Redis]
        
        B1[ç®¡ç†å‘˜æ”¹èœå“] --> B2[è°ƒç”¨clearCacheæ–¹æ³•]
        B2 --> B3[redisTemplate.delete]
    end
    
    subgraph å¥—é¤æ¨¡å—-SpringCache
        C1[ç”¨æˆ·æŸ¥å¥—é¤] --> C2["@Cacheable<br/>ä¸€è¡Œæå®š"]
        
        D1[ç®¡ç†å‘˜æ”¹å¥—é¤] --> D2["@CacheEvict<br/>ä¸€è¡Œæå®š"]
    end
```

---

## ğŸ¯ é¢è¯•å¿…é—®ç‚¹

### Q1: Spring Cache çš„åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ

> **ç­”**ï¼šåŸºäº **AOPï¼ˆé¢å‘åˆ‡é¢ç¼–ç¨‹ï¼‰** å®ç°ã€‚Spring åœ¨è¿è¡Œæ—¶ä¸ºå¸¦æœ‰ç¼“å­˜æ³¨è§£çš„æ–¹æ³•åˆ›å»ºä»£ç†å¯¹è±¡ï¼Œåœ¨æ–¹æ³•æ‰§è¡Œå‰åç»‡å…¥ç¼“å­˜é€»è¾‘ã€‚

### Q2ï¼ˆè¿½é—®ï¼‰: é‚£ Spring Cache æœ‰ä»€ä¹ˆå‘å—ï¼Ÿ

> **ç­”**ï¼šæœ‰ï¼**åŒä¸€ä¸ªç±»ä¸­æ–¹æ³•äº’ç›¸è°ƒç”¨ï¼Œç¼“å­˜æ³¨è§£ä¼šå¤±æ•ˆ**ï¼å› ä¸ºå†…éƒ¨è°ƒç”¨ä¸èµ°ä»£ç†å¯¹è±¡ã€‚
> 
> ```java
> public class SetmealController {
>     public void methodA() {
>         this.methodB();  // âŒ ç¼“å­˜æ³¨è§£å¤±æ•ˆï¼
>     }
>     
>     @Cacheable(...)
>     public void methodB() { ... }
> }
> ```

### Q3: @Cacheable çš„ key æ€ä¹ˆå†™ï¼Ÿ

> **ç­”**ï¼šä½¿ç”¨ **SpELï¼ˆSpring Expression Languageï¼‰** è¡¨è¾¾å¼ï¼š
> - `#å‚æ•°å` â†’ å–æ–¹æ³•å‚æ•°
> - `#å¯¹è±¡.å±æ€§` â†’ å–å¯¹è±¡çš„å±æ€§
> - `#result` â†’ å–è¿”å›å€¼ï¼ˆä»…@CachePutå¯ç”¨ï¼‰
> - `#root.methodName` â†’ å–æ–¹æ³•å

### Q4: å¦‚æœç¼“å­˜å’Œæ•°æ®åº“æ•°æ®ä¸ä¸€è‡´æ€ä¹ˆåŠï¼Ÿ

> **ç­”**ï¼šè¿™å°±æ˜¯**ç¼“å­˜ä¸€è‡´æ€§é—®é¢˜**ï¼å¸¸è§ç­–ç•¥ï¼š
> 1. **Cache Aside Pattern**ï¼ˆæ—è·¯ç¼“å­˜ï¼‰- æœ¬é¡¹ç›®ç”¨çš„å°±æ˜¯è¿™ä¸ª
>    - è¯»ï¼šå…ˆè¯»ç¼“å­˜ï¼Œæ²¡æœ‰å†è¯»DBå¹¶å›å†™
>    - å†™ï¼šå…ˆæ›´æ–°DBï¼Œå†åˆ é™¤ç¼“å­˜
> 2. è®¾ç½®**è¿‡æœŸæ—¶é—´**ä½œä¸ºå…œåº•
> 3. æ›´å¤§å¹¶å‘åœºæ™¯ï¼šç”¨æ¶ˆæ¯é˜Ÿåˆ—å¼‚æ­¥æ›´æ–°ç¼“å­˜

---

## ğŸ—‚ï¸ å…³è”æ–‡ä»¶

```text
com/sky/controller/user/SetmealController.java
com/sky/controller/admin/SetmealController.java
```
